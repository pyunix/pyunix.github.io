<!---
HTML file to kick-start pyunix into pyscript

Loads the latest stable CSS and pyscript.js, then uses "minimal" py-script commands to 
prepare for terminals and the remaining pyunix environment

Tries to be as "python" as possible
--->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" Content="IE-Edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Test</title>
	<link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
	<script defer src="https://pyscript.net/latest/pyscript.js"></script>
</head>
<body>

	<div style="minheight: 200" id="myscreen" value="This is my screen">
		Hello
	</div>
	<py-script>
		from js import document
		from pyodide.ffi.wrappers import add_event_listener
		from io import StringIO
		import sys

		RealStdout = sys.stdout
		RealStderr = sys.stderr
		global ScreenBuffer
		ScreenBuffer = "Welcome to Python Xterminal"
		xdisp = Element("myscreen")

		def write_stdout(text):
			print(text,file=RealStdout)

		def write_stderr(text):
			print(text,file=RealStderr)


		def handle_keypress(evt):
			#ScreenBuffer += str(evt.key)
			ScreenBuffer = "abc" + "def"
			xdisp.element.innerHTML = ScreenBuffer  
			write_stdout("pressed1 "+str(evt.key))

		document.onkeydown = handle_keypress  
  
		NewStdout = StringIO()
		sys.stdout = NewStdout
	</py-script>
	<div> 
		<py-repl id="my-repl" auto-generate="true"> </py-repl>
	</div>

</body>
</html>
